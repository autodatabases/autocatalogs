// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("apps.autocatalogs.db")
}

model Body {
  ///Идентификатор
  id           Int            @id @default(autoincrement())
  ///Наименование
  name         String         @db.VarChar(15)
  ///Код
  code         String         @db.VarChar(15)
  avitoCode    String         @db.VarChar(15)
  modelBody    ModelBody[]
  modification Modification[]
}

model Manufacturer {
  ///Идентификатор
  id        Int     @id @default(autoincrement())
  ///Наименование
  name      String  @unique @db.VarChar(20)
  ///Код
  code      String  @unique @db.VarChar(30)
  avitoCode String? @db.VarChar(30)
  model     Model[]
}

model Model {
  ///Идентификатор
  id                Int                 @id @default(autoincrement())
  ///Наименование
  name              String              @db.VarChar(50)
  ///Код
  code              String              @db.VarChar(70)
  avitoCode         String?             @db.VarChar(70)
  manufacturerId    Int
  bodyId            Int?
  transmissionId    Int?
  driveId           Int?
  manufacturer      Manufacturer        @relation(fields: [manufacturerId], references: [id])
  modelBody         ModelBody[]
  modelDrive        ModelDrive[]
  modelTransmission ModelTransmission[]
  enginePower       Int?
  engineCapacity    Decimal?            @db.Decimal(2, 1)
  modification      Modification[]

  @@unique([id, manufacturerId])
}

model ModelBody {
  ///Идентификатор
  id      Int    @id @default(autoincrement())
  modelId Int?
  bodyId  Int?
  body    Body?  @relation(fields: [bodyId], references: [id])
  model   Model? @relation(fields: [modelId], references: [id])

  @@unique([modelId, bodyId])
}

model ModelTransmission {
  ///Идентификатор
  id             Int           @id @default(autoincrement())
  modelId        Int?
  transmissionId Int?
  model          Model?        @relation(fields: [modelId], references: [id])
  transmission   Transmission? @relation(fields: [transmissionId], references: [id])

  @@unique([modelId, transmissionId])
}

model Transmission {
  ///Идентификатор
  id                Int                 @id @default(autoincrement())
  ///Наименование
  name              String              @db.VarChar(10)
  ///Код
  code              String              @db.VarChar(10)
  avitoCode         String              @db.VarChar(10)
  modelTransmission ModelTransmission[]
  modification      Modification[]
}

model Drive {
  ///Идентификатор
  id           Int            @id @default(autoincrement())
  ///Наименование
  name         String         @db.VarChar(10)
  ///Код
  code         String         @db.VarChar(10)
  avitoCode    String         @db.VarChar(10)
  modelDrive   ModelDrive[]
  modification Modification[]
}

model ModelDrive {
  id      Int    @id @default(autoincrement())
  modelId Int?
  driveId Int?
  drive   Drive? @relation(fields: [driveId], references: [id])
  model   Model? @relation(fields: [modelId], references: [id])

  @@unique([modelId, driveId])
}

model Modification {
  id                  Int           @id
  avitoModificationId Int?
  model               Model?        @relation(fields: [modelId], references: [id])
  modelId             Int?
  transmission        Transmission? @relation(fields: [transmissionId], references: [id])
  transmissionId      Int?
  body                Body?         @relation(fields: [bodyId], references: [id])
  bodyId              Int?
  drive               Drive?        @relation(fields: [driveId], references: [id])
  driveId             Int?
  yearFrom            Int?          @db.SmallInt
  yearTo              Int?          @db.SmallInt
  enginePower         Int?
  engineCapacity      Decimal?      @db.Decimal(2, 1)
  name                String?       @db.VarChar(150)
  code                String?       @db.VarChar(100)
}
